<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>3D Carousel Template - Only at The Kiosk</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  
  <!-- Swiper CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css"/>
  
  <!-- Custom Styles -->
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background-color: #000;
      color: #fff;
      overflow-x: hidden;
      overscroll-behavior: none;
    }

    /* Fade-up elements start hidden */
    [fade-up], [carousel="wrap"] { 
      opacity: 0;
    }

    /* 3D Carousel Container */
    [carousel="component"] {
      position: relative;
      width: 100%;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 2rem;
    }

    /* 3D Carousel Wrapper */
    [carousel="wrap"] {
      will-change: contents;
      --3d-carousel-item-width: 40vw;
      --3d-carousel-gap: 7vw;
      --3d-carousel-rotate: 0deg;
      --3d-carousel-rotate-x: 0deg;
      --3d-carousel-z: 0px;
      position: relative;
      width: 100%;
      height: 60vh;
      margin-bottom: 4rem;
      display: flex;
      align-items: center;
      justify-content: center;
      perspective-origin: center center;
    }

    /* Tablet Responsive */
    @media screen and (max-width: 991px) {
      [carousel="wrap"] {
        --3d-carousel-item-width: 70vw;
        --3d-carousel-gap: 6vw;
        height: 50vh;
      }
    }

    /* 3D Transform Container */
    [carousel="wrap"] > div {
      transform-style: preserve-3d;
      transform: translate3d(0px, 0px, var(--3d-carousel-z)) rotateX(var(--3d-carousel-rotate-x)) rotateY(var(--3d-carousel-rotate));
      width: 100%;
      height: 100%;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      transform-origin: center center;
    }

    /* Individual Item Container */
    [carousel="wrap"] > div > div {
      width: var(--3d-carousel-item-width);
      position: absolute;
      transform-origin: center center;
    }

    /* Carousel List */
    .carousel_list {
      list-style: none;
      width: 100%;
      height: 100%;
    }

    /* Carousel Item */
    .carousel_item {
      position: absolute;
      width: 100%;
      height: 100%;
      transform-origin: center center;
      top: 0;
      left: 0;
    }

    /* Carousel Image */
    .carousel_img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    }

    /* Carousel Ratio (for aspect ratio) */
    .carousel_ratio {
      padding-bottom: 56.25%; /* 16:9 aspect ratio */
    }

    /* Swiper Container for Titles */
    .swiper {
      width: 100%;
      max-width: 600px;
      height: 200px;
      margin-bottom: 2rem;
    }

    .swiper-slide {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 2rem;
    }

    .swiper-slide h2 {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: #fff;
    }

    @media screen and (max-width: 991px) {
      .swiper-slide h2 {
        font-size: 2rem;
      }
    }

    .swiper-slide .button {
      padding: 12px 32px;
      background-color: #fff;
      color: #000;
      text-decoration: none;
      border-radius: 50px;
      font-weight: 600;
      transition: all 0.3s ease;
      display: inline-block;
    }

    .swiper-slide .button:hover {
      background-color: #f0f0f0;
      transform: scale(1.05);
    }

    /* Navigation Arrows */
    .carousel_arrow_wrap {
      display: flex;
      gap: 1rem;
      pointer-events: none;
    }

    .carousel_arrow_link {
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      cursor: pointer;
      pointer-events: auto;
      transition: all 0.3s ease;
      position: relative;
    }

    .carousel_arrow_link:hover {
      background-color: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.5);
      transform: scale(1.1);
    }

    .carousel_arrow_link::before {
      content: '';
      width: 12px;
      height: 12px;
      border-top: 2px solid #fff;
      border-right: 2px solid #fff;
      transform: rotate(-45deg);
    }

    .carousel_arrow_link.is-right::before {
      transform: rotate(135deg);
    }

    /* Disabled State */
    .swiper-button-disabled {
      pointer-events: none;
      opacity: 0.4;
    }

    /* Product Drawer Styles */
    .products_collection-drawer {
      z-index: 1000;
      display: none;
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .products_collection-drawer.open {
      display: flex;
    }

    .products_drawer-close {
      flex: 1;
      cursor: pointer;
    }

    .products_drawer-wrapper {
      border-left: 1px solid #666;
      background-color: #fff;
      color: #000;
      width: 50vw;
      max-width: 600px;
      padding-bottom: 3rem;
      padding-left: 1.5rem;
      padding-right: 3rem;
      overflow-y: auto;
      position: relative;
      animation: slideInRight 0.3s ease-out;
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
      }
      to {
        transform: translateX(0);
      }
    }

    @media screen and (max-width: 991px) {
      .products_drawer-wrapper {
        width: 85vw;
        max-width: none;
      }
    }

    @media screen and (max-width: 479px) {
      .products_drawer-wrapper {
        width: 100vw;
      }
    }

    .products_drawer-close-icon {
      width: 40px;
      height: 40px;
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      font-size: 2rem;
      line-height: 1;
      color: #000;
      cursor: pointer;
      z-index: 10;
      transition: opacity 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .products_drawer-close-icon:hover {
      opacity: 0.6;
    }

    .products_drawer-title {
      border-bottom: 1px solid #666;
      justify-content: space-between;
      margin-top: 3.5rem;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      display: flex;
      align-items: baseline;
    }

    .products_drawer-title h3 {
      font-size: 1.5rem;
      font-weight: 700;
      margin: 0;
      color: #000;
    }

    .products_drawer-title h3:last-child {
      font-weight: 400;
      color: #666;
    }

    .products_drawer-content {
      grid-column-gap: 1.5rem;
      grid-row-gap: 1.5rem;
      grid-template-rows: auto;
      grid-template-columns: 1fr 1fr;
      grid-auto-columns: 1fr;
      align-items: start;
      height: auto;
      display: grid;
    }

    @media screen and (max-width: 767px) {
      .products_drawer-content {
        grid-template-columns: 1fr;
      }
    }

    .products_drawer-images {
      grid-column-gap: 1.5rem;
      grid-row-gap: 1.5rem;
      grid-template-rows: auto auto;
      grid-template-columns: 1fr;
      grid-auto-columns: 1fr;
      display: grid;
    }

    .products_drawer-main-image {
      object-fit: cover;
      width: 100%;
      height: auto;
      max-height: 22rem;
      border-radius: 8px;
    }

    .products_drawer-more-collection {
      grid-column-gap: 1rem;
      grid-row-gap: 1rem;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      display: grid;
    }

    .products_drawer-more-item {
      max-height: 100px;
      overflow: hidden;
      border-radius: 4px;
      cursor: pointer;
      transition: opacity 0.3s ease;
    }

    .products_drawer-more-item:hover {
      opacity: 0.7;
    }

    .products_drawer-more-image {
      object-fit: cover;
      width: 100%;
      height: 100%;
    }

    .products_drawer-text {
      padding-top: 1.5rem;
      position: sticky;
      top: 1.5rem;
    }

    .products_quantity-wrapper {
      margin-bottom: 1rem;
    }

    .margin-bottom.margin-xsmall {
      margin-bottom: 0.5rem;
    }

    .uppercase {
      text-transform: uppercase;
      font-size: 0.875rem;
      font-weight: 600;
      color: #000;
      letter-spacing: 0.05em;
    }

    .products_quantity {
      border: 1px solid #ccc;
      background-color: #fff;
      text-align: center;
      border-radius: 4px;
      width: 80px;
      padding: 0.5rem;
      font-size: 1rem;
    }

    .button-secondary {
      border: 1px solid #000;
      background-color: #000;
      color: #fff;
      text-align: center;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      border-radius: 4px;
      padding: 0.75rem 2rem;
      font-size: 0.875rem;
      font-weight: 600;
      transition: all 0.3s ease;
      cursor: pointer;
      width: 100%;
      margin-top: 1rem;
    }

    .button-secondary:hover {
      background-color: #333;
      border-color: #333;
    }

    .products_text-top {
      border-bottom: 1px solid #ccc;
      margin-bottom: 1.5rem;
      padding-bottom: 1.5rem;
    }

    .products_out-of-stock,
    .products_error {
      background-color: #f5f5f5;
      color: #d32f2f;
      padding: 1rem;
      margin-top: 1rem;
      border-radius: 4px;
      font-size: 0.875rem;
    }

    .products_text-bottom {
      margin-top: 1.5rem;
    }

    .margin-bottom.margin-medium {
      margin-bottom: 1rem;
    }

    .products_description-item {
      border-bottom: 1px solid #ccc;
      padding-top: 0.75rem;
      padding-bottom: 0.75rem;
      position: relative;
    }

    .products_description-item:last-child {
      border-bottom: none;
    }

    .products_description-question {
      justify-content: space-between;
      align-items: center;
      padding-top: 0;
      padding-bottom: 0;
      display: flex;
      cursor: pointer;
    }

    .products_description-question:hover {
      opacity: 0.7;
    }

    .products_description-left {
      align-items: center;
      display: flex;
    }

    .products_description-icon {
      width: 1.25rem;
      height: 1.25rem;
      margin-right: 0.5rem;
      font-size: 1.25rem;
      line-height: 1;
    }

    .products_description-question p {
      margin: 0;
      font-weight: 500;
      color: #000;
    }

    .product_description-plus {
      font-size: 1.5rem;
      font-weight: 300;
      color: #000;
      transition: transform 0.3s ease;
      line-height: 1;
    }

    .products_description-item.active .product_description-plus {
      transform: rotate(45deg);
    }

    .products_description-answer {
      display: none;
      padding-top: 0.75rem;
      color: #666;
    }

    .products_description-item.active .products_description-answer {
      display: block;
    }

    .products_description-answer .paragraph {
      color: #666;
      line-height: 1.6;
    }

    .drawer-loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: #fff;
      z-index: 1001;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 1rem;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .drawer-loading p {
      margin: 0;
      font-size: 0.875rem;
    }
  </style>
</head>
<body>
  <!-- 3D Carousel Component -->
  <div carousel="component" class="carousel_component">
    
    <!-- 3D Image Carousel -->
    <div carousel="wrap" class="carousel_wrap">
      <div class="carousel_list">
        <!-- Carousel Items - Add your images here -->
        <div class="carousel_item">
          <img src="https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=1080" alt="Product 1" class="carousel_img">
          <div class="carousel_ratio"></div>
        </div>
        <div class="carousel_item">
          <img src="https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=1080" alt="Product 2" class="carousel_img">
          <div class="carousel_ratio"></div>
        </div>
        <div class="carousel_item">
          <img src="https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=1080" alt="Product 3" class="carousel_img">
          <div class="carousel_ratio"></div>
        </div>
        <div class="carousel_item">
          <img src="https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=1080" alt="Product 4" class="carousel_img">
          <div class="carousel_ratio"></div>
        </div>
        <div class="carousel_item">
          <img src="https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=1080" alt="Product 5" class="carousel_img">
          <div class="carousel_ratio"></div>
        </div>
        <div class="carousel_item">
          <img src="https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=1080" alt="Product 6" class="carousel_img">
          <div class="carousel_ratio"></div>
        </div>
        <div class="carousel_item">
          <img src="https://images.unsplash.com/photo-1586495777744-4413f21062fa?w=1080" alt="Product 7" class="carousel_img">
          <div class="carousel_ratio"></div>
        </div>
        <div class="carousel_item">
          <img src="https://images.unsplash.com/photo-1578587018452-892bacefd3f2?w=1080" alt="Product 8" class="carousel_img">
          <div class="carousel_ratio"></div>
        </div>
        <div class="carousel_item">
          <img src="https://images.unsplash.com/photo-1560472355-536de3962603?w=1080" alt="Product 9" class="carousel_img">
          <div class="carousel_ratio"></div>
        </div>
        <div class="carousel_item">
          <img src="https://images.unsplash.com/photo-1558199141-0d5b1e0f3c4a?w=1080" alt="Product 10" class="carousel_img">
          <div class="carousel_ratio"></div>
        </div>
        <div class="carousel_item">
          <img src="https://images.unsplash.com/photo-1515955656352-a1fa3ffcd111?w=1080" alt="Product 11" class="carousel_img">
          <div class="carousel_ratio"></div>
        </div>
        <div class="carousel_item">
          <img src="https://images.unsplash.com/photo-1558769132-cb1aea458c5e?w=1080" alt="Product 12" class="carousel_img">
          <div class="carousel_ratio"></div>
        </div>
        <div class="carousel_item">
          <img src="https://images.unsplash.com/photo-1560769629-975ec94e6a86?w=1080" alt="Product 13" class="carousel_img">
          <div class="carousel_ratio"></div>
        </div>
        <div class="carousel_item">
          <img src="https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=1080" alt="Product 14" class="carousel_img">
          <div class="carousel_ratio"></div>
        </div>
        <div class="carousel_item">
          <img src="https://images.unsplash.com/photo-1571781926291-c477ebfd024b?w=1080" alt="Product 15" class="carousel_img">
          <div class="carousel_ratio"></div>
        </div>
        <div class="carousel_item">
          <img src="https://images.unsplash.com/photo-1595950653106-6c9ebd614d3a?w=1080" alt="Product 16" class="carousel_img">
          <div class="carousel_ratio"></div>
        </div>
      </div>
    </div>

    <!-- Swiper Slider for Titles -->
    <div fade-up="" class="swiper">
      <div class="swiper-wrapper">
        <!-- Slides - Add your titles here -->
        <!-- Add data-product-handle attribute with your Shopify product handle -->
        <div class="swiper-slide" data-product-handle="product-handle-1">
          <h2>NeoTech</h2>
          <a href="#" class="button view-details-btn">view details</a>
        </div>
        <div class="swiper-slide" data-product-handle="product-handle-2">
          <h2>Innovate</h2>
          <a href="#" class="button view-details-btn">view details</a>
        </div>
        <div class="swiper-slide" data-product-handle="product-handle-3">
          <h2>Catalyst</h2>
          <a href="#" class="button view-details-btn">view details</a>
        </div>
        <div class="swiper-slide" data-product-handle="product-handle-4">
          <h2>Quantum</h2>
          <a href="#" class="button view-details-btn">view details</a>
        </div>
        <div class="swiper-slide" data-product-handle="product-handle-5">
          <h2>Fusion</h2>
          <a href="#" class="button view-details-btn">view details</a>
        </div>
        <div class="swiper-slide" data-product-handle="product-handle-6">
          <h2>Apex</h2>
          <a href="#" class="button view-details-btn">view details</a>
        </div>
        <div class="swiper-slide" data-product-handle="product-handle-7">
          <h2>Evolve</h2>
          <a href="#" class="button view-details-btn">view details</a>
        </div>
        <div class="swiper-slide" data-product-handle="product-handle-8">
          <h2>Synergy</h2>
          <a href="#" class="button view-details-btn">view details</a>
        </div>
        <div class="swiper-slide" data-product-handle="product-handle-9">
          <h2>Lumina</h2>
          <a href="#" class="button view-details-btn">view details</a>
        </div>
        <div class="swiper-slide" data-product-handle="product-handle-10">
          <h2>Pinnacle</h2>
          <a href="#" class="button view-details-btn">view details</a>
        </div>
        <div class="swiper-slide" data-product-handle="product-handle-11">
          <h2>Odyssey</h2>
          <a href="#" class="button view-details-btn">view details</a>
        </div>
        <div class="swiper-slide" data-product-handle="product-handle-12">
          <h2>Zenith</h2>
          <a href="#" class="button view-details-btn">view details</a>
        </div>
        <div class="swiper-slide" data-product-handle="product-handle-13">
          <h2>Elysium</h2>
          <a href="#" class="button view-details-btn">view details</a>
        </div>
        <div class="swiper-slide" data-product-handle="product-handle-14">
          <h2>Nexus</h2>
          <a href="#" class="button view-details-btn">view details</a>
        </div>
        <div class="swiper-slide" data-product-handle="product-handle-15">
          <h2>Stellar</h2>
          <a href="#" class="button view-details-btn">view details</a>
        </div>
        <div class="swiper-slide" data-product-handle="product-handle-16">
          <h2>Vortex</h2>
          <a href="#" class="button view-details-btn">view details</a>
        </div>
      </div>
    </div>

    <!-- Navigation Arrows -->
    <div fade-up="" class="carousel_arrow_wrap">
      <a carousel="prev" href="#" class="carousel_arrow_link"></a>
      <a carousel="next" href="#" class="carousel_arrow_link is-right"></a>
    </div>
  </div>

  <!-- Product Drawer -->
  <div class="products_collection-drawer" id="product-drawer">
    <div class="products_drawer-close" id="drawer-close-overlay"></div>
    <div class="products_drawer-wrapper">
      <button class="products_drawer-close-icon" id="drawer-close-btn" aria-label="Close drawer">√ó</button>
      
      <div class="products_drawer-title">
        <h3 id="drawer-product-title"></h3>
        <h3 id="drawer-product-price"></h3>
      </div>
      
      <div class="products_drawer-content">
        <!-- Images Section -->
        <div class="products_drawer-images">
          <img src="" loading="lazy" alt="Product image" class="products_drawer-main-image" id="drawer-main-image">
          <div class="products_drawer-more-collection" id="drawer-gallery">
            <!-- Gallery images will be populated dynamically -->
          </div>
        </div>
        
        <!-- Product Details Section -->
        <div class="products_drawer-text">
          <div class="products_text-top">
            <div class="products_quantity-wrapper">
              <div class="margin-bottom margin-xsmall">
                <h4 class="uppercase">qty</h4>
              </div>
              <input type="number" pattern="^[0-9]+$" inputmode="numeric" id="drawer-quantity" name="quantity" min="1" class="products_quantity" value="1">
            </div>
            <button id="drawer-add-to-cart" class="button-secondary">Add to Cart</button>
            <div style="display:none" class="products_out-of-stock" id="drawer-out-of-stock">
              <div>This product is out of stock.</div>
            </div>
            <div style="display:none" class="products_error" id="drawer-error">
              <div>Error loading product details.</div>
            </div>
          </div>
          
          <div class="products_text-bottom">
            <div class="margin-bottom margin-medium">
              <h4 class="uppercase">product info</h4>
            </div>
            
            <!-- Description Section -->
            <div class="products_description-item">
              <div class="products_description-question">
                <div class="products_description-left">
                  <span class="products_description-icon">üìÑ</span>
                  <p>Description</p>
                </div>
                <span class="product_description-plus">+</span>
              </div>
              <div class="products_description-answer" style="display:none;">
                <div class="paragraph" id="drawer-description"></div>
              </div>
            </div>
            
            <!-- Care Instructions Section -->
            <div class="products_description-item">
              <div class="products_description-question">
                <div class="products_description-left">
                  <span class="products_description-icon">‚ÑπÔ∏è</span>
                  <p>Care Instructions</p>
                </div>
                <span class="product_description-plus">+</span>
              </div>
              <div class="products_description-answer" style="display:none;">
                <div class="paragraph" id="drawer-care-instructions"></div>
              </div>
            </div>
            
            <!-- Delivery Section -->
            <div class="products_description-item">
              <div class="products_description-question">
                <div class="products_description-left">
                  <span class="products_description-icon">üöö</span>
                  <p>Delivery</p>
                </div>
                <span class="product_description-plus">+</span>
              </div>
              <div class="products_description-answer" style="display:none;">
                <p id="drawer-delivery"></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Loading Spinner -->
    <div class="drawer-loading" id="drawer-loading" style="display:none;">
      <div class="loading-spinner"></div>
      <p>Loading product details...</p>
    </div>
  </div>

  <!-- Scripts -->
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  
  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  
  <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>

  <!-- 3D Carousel Script -->
  <script>
    $(document).ready(function() {
      $("[carousel='component']").each(function () {
        let componentEl = $(this);
        let wrapEl = componentEl.find("[carousel='wrap']");
        let swiperEl = componentEl.find(".swiper");
        let itemEl = wrapEl.find(".carousel_item");
        let nextEl = componentEl.find("[carousel='next']");
        let prevEl = componentEl.find("[carousel='prev']");
        
        // Calculate rotation angle per item (360¬∞ / number of items)
        let rotateAmount = 360 / itemEl.length;
        
        // Calculate Z-distance for proper 3D perspective
        let zTranslate = 2 * Math.tan((rotateAmount / 2) * (Math.PI / 180));
        
        // Calculate translate values
        let negTranslate = `calc(var(--3d-carousel-item-width) / -${zTranslate} - var(--3d-carousel-gap))`;
        let posTranslate = `calc(var(--3d-carousel-item-width) / ${zTranslate} + var(--3d-carousel-gap))`;

        // Set perspective and Z-position
        wrapEl.css("--3d-carousel-z", negTranslate);
        wrapEl.css("perspective", posTranslate);
        
        // Position each item in 3D space
        // Items are centered at origin, then rotated and translated outward
        itemEl.each(function (index) {
          $(this).css({
            left: '50%',
            top: '50%',
            transform: `translate(-50%, -50%) rotateY(${rotateAmount * index}deg) translateZ(${posTranslate})`
          });
        });

        // INTRO ANIMATION
        let introTl = gsap.timeline({
          onComplete: () => {
            swiperCode();
          }
        });
        
        // Fade in
        introTl.to(wrapEl, { opacity: 1, duration: 0.3 });
        
        // Rotate from off-screen to position
        introTl.fromTo(
          wrapEl, 
          { 
            "--3d-carousel-rotate": 100,
            "--3d-carousel-rotate-x": -90
          }, 
          { 
            "--3d-carousel-rotate": 0,
            "--3d-carousel-rotate-x": -4,
            duration: 4, 
            ease: "power2.inOut" 
          }, 
          "<"
        );
        
        // Fade in titles and arrows
        introTl.to("[fade-up]", { opacity: 1 }, ">-0.3");

        function swiperCode() {
          // Create continuous rotation timeline
          let tl = gsap.timeline({ paused: true });
          tl.fromTo(
            wrapEl, 
            { "--3d-carousel-rotate": 0 }, 
            { 
              "--3d-carousel-rotate": -(360 - rotateAmount),
              duration: 30, 
              ease: "none" 
            }
          );

          // Progress tracker for syncing
          let progress = { value: 0 };

          // Initialize Swiper
          const swiper = new Swiper(swiperEl[0], {
            effect: "creative",
            creativeEffect: {
              prev: {
                translate: [0, "-100%", 0],
                scale: 0.5,
                opacity: 0
              },
              next: {
                translate: [0, "100%", 0],
                scale: 0.5,
                opacity: 0
              }
            },
            grabCursor: true,
            keyboard: true,
            speed: 500,
            mousewheel: {
              eventsTarget: "[carousel='component']"
            },
            navigation: {
              nextEl: nextEl[0],
              prevEl: prevEl[0]
            }
          });
          
          // Sync Swiper progress with 3D rotation
          swiper.on("progress", function (e) {
            gsap.to(progress, {
              value: e.progress,
              onUpdate: () => {
                tl.progress(progress.value);
              }
            });
          });

          // Update arrow states
          swiper.on("reachBeginning", function () {
            prevEl.addClass("swiper-button-disabled");
          });
          swiper.on("reachEnd", function () {
            nextEl.addClass("swiper-button-disabled");
          });
          swiper.on("fromEdge", function () {
            prevEl.removeClass("swiper-button-disabled");
            nextEl.removeClass("swiper-button-disabled");
          });
        }
      });
    });

    // Product Drawer Functionality
    $(document).ready(function() {
      const drawer = $('#product-drawer');
      const drawerOverlay = $('#drawer-close-overlay');
      const drawerCloseBtn = $('#drawer-close-btn');
      const viewDetailsBtns = $('.view-details-btn');
      
      // Shopify Storefront API Configuration
      // For production, move token to Cloudflare Pages environment variables
      // Note: If API calls fail, try using your myshopify.com domain (e.g., onlyatthekiosk.myshopify.com)
      const SHOPIFY_STORE = 'onlyatthekiosk.com';
      const SHOPIFY_TOKEN = '3c7e207a3167fe57edd75d8133a36967'; // TODO: Move to environment variable for production
      const SHOPIFY_API_URL = `https://${SHOPIFY_STORE}/api/2024-01/graphql.json`;

      // GraphQL query to fetch product by handle
      function getProductQuery(handle) {
        return `
          query getProduct($handle: String!) {
            product(handle: $handle) {
              id
              title
              description
              descriptionHtml
              priceRange {
                minVariantPrice {
                  amount
                  currencyCode
                }
              }
              images(first: 10) {
                edges {
                  node {
                    id
                    url
                    altText
                  }
                }
              }
              variants(first: 1) {
                edges {
                  node {
                    id
                    availableForSale
                    price {
                      amount
                      currencyCode
                    }
                  }
                }
              }
              metafields(identifiers: [
                {namespace: "custom", key: "care_instructions"}
                {namespace: "custom", key: "delivery"}
              ]) {
                id
                namespace
                key
                value
                type
              }
            }
          }
        `;
      }

      // Fetch product from Shopify Storefront API
      async function fetchProduct(handle) {
        try {
          const response = await fetch(SHOPIFY_API_URL, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-Shopify-Storefront-Access-Token': SHOPIFY_TOKEN
            },
            body: JSON.stringify({
              query: getProductQuery(handle),
              variables: { handle: handle }
            })
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          
          if (data.errors) {
            throw new Error(data.errors[0].message);
          }

          return data.data.product;
        } catch (error) {
          console.error('Error fetching product:', error);
          throw error;
        }
      }

      // Populate drawer with product data
      function populateDrawer(product) {
        // Product title and price
        $('#drawer-product-title').text(product.title);
        const price = product.priceRange.minVariantPrice;
        $('#drawer-product-price').text(`${price.amount} ${price.currencyCode}`);

        // Main image
        if (product.images.edges.length > 0) {
          const mainImage = product.images.edges[0].node;
          $('#drawer-main-image').attr('src', mainImage.url).attr('alt', mainImage.altText || product.title);
          
          // Gallery images
          const gallery = $('#drawer-gallery');
          gallery.empty();
          
          if (product.images.edges.length > 1) {
            product.images.edges.slice(1).forEach(({ node: image }) => {
              const galleryItem = $('<div class="products_drawer-more-item"></div>');
              const galleryImg = $('<img class="products_drawer-more-image" loading="lazy">');
              galleryImg.attr('src', image.url).attr('alt', image.altText || product.title);
              galleryItem.append(galleryImg);
              galleryItem.on('click', () => {
                $('#drawer-main-image').attr('src', image.url).attr('alt', image.altText || product.title);
              });
              gallery.append(galleryItem);
            });
          }
        }

        // Description
        if (product.descriptionHtml) {
          $('#drawer-description').html(product.descriptionHtml);
        } else if (product.description) {
          $('#drawer-description').text(product.description);
        } else {
          $('#drawer-description').text('No description available.');
        }

        // Care instructions (from metafield)
        const careInstructionsMetafield = product.metafields?.find(m => m.key === 'care_instructions');
        if (careInstructionsMetafield) {
          if (careInstructionsMetafield.type === 'rich_text_field' || careInstructionsMetafield.type === 'multi_line_text_field') {
            $('#drawer-care-instructions').html(careInstructionsMetafield.value);
          } else {
            $('#drawer-care-instructions').text(careInstructionsMetafield.value);
          }
        } else {
          $('#drawer-care-instructions').html('<p>Care instructions not available.</p>');
        }

        // Delivery (from metafield or default)
        const deliveryMetafield = product.metafields?.find(m => m.key === 'delivery');
        if (deliveryMetafield) {
          $('#drawer-delivery').html(deliveryMetafield.value);
        } else {
          $('#drawer-delivery').text('Standard delivery information will be displayed here.');
        }

        // Stock status
        const isAvailable = product.variants.edges[0]?.node.availableForSale || false;
        if (!isAvailable) {
          $('#drawer-out-of-stock').show();
          $('#drawer-add-to-cart').prop('disabled', true);
        } else {
          $('#drawer-out-of-stock').hide();
          $('#drawer-add-to-cart').prop('disabled', false);
        }

        // Hide error if previously shown
        $('#drawer-error').hide();
      }

      // Placeholder product data for template products
      // Each product handle corresponds to a carousel slide
      function getPlaceholderProduct(productHandle) {
        const placeholderImages = [
          { main: 'https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=800', gallery: ['https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=400', 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=400', 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400'] },
          { main: 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=800', gallery: ['https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=400', 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=400'] },
          { main: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=800', gallery: ['https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=400', 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400'] },
          { main: 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=800', gallery: ['https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=400', 'https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=400'] },
          { main: 'https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=800', gallery: ['https://images.unsplash.com/photo-1586495777744-4413f21062fa?w=400', 'https://images.unsplash.com/photo-1578587018452-892bacefd3f2?w=400'] },
          { main: 'https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=800', gallery: ['https://images.unsplash.com/photo-1560472355-536de3962603?w=400', 'https://images.unsplash.com/photo-1558199141-0d5b1e0f3c4a?w=400'] },
          { main: 'https://images.unsplash.com/photo-1586495777744-4413f21062fa?w=800', gallery: ['https://images.unsplash.com/photo-1515955656352-a1fa3ffcd111?w=400', 'https://images.unsplash.com/photo-1558769132-cb1aea458c5e?w=400'] },
          { main: 'https://images.unsplash.com/photo-1578587018452-892bacefd3f2?w=800', gallery: ['https://images.unsplash.com/photo-1560769629-975ec94e6a86?w=400', 'https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=400'] },
          { main: 'https://images.unsplash.com/photo-1560472355-536de3962603?w=800', gallery: ['https://images.unsplash.com/photo-1571781926291-c477ebfd024b?w=400', 'https://images.unsplash.com/photo-1595950653106-6c9ebd614d3a?w=400'] },
          { main: 'https://images.unsplash.com/photo-1558199141-0d5b1e0f3c4a?w=800', gallery: ['https://images.unsplash.com/photo-1515955656352-a1fa3ffcd111?w=400', 'https://images.unsplash.com/photo-1558769132-cb1aea458c5e?w=400'] },
          { main: 'https://images.unsplash.com/photo-1515955656352-a1fa3ffcd111?w=800', gallery: ['https://images.unsplash.com/photo-1560769629-975ec94e6a86?w=400', 'https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=400'] },
          { main: 'https://images.unsplash.com/photo-1558769132-cb1aea458c5e?w=800', gallery: ['https://images.unsplash.com/photo-1571781926291-c477ebfd024b?w=400', 'https://images.unsplash.com/photo-1595950653106-6c9ebd614d3a?w=400'] },
          { main: 'https://images.unsplash.com/photo-1560769629-975ec94e6a86?w=800', gallery: ['https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=400', 'https://images.unsplash.com/photo-1571781926291-c477ebfd024b?w=400'] },
          { main: 'https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=800', gallery: ['https://images.unsplash.com/photo-1595950653106-6c9ebd614d3a?w=400', 'https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=400'] },
          { main: 'https://images.unsplash.com/photo-1571781926291-c477ebfd024b?w=800', gallery: ['https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=400', 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=400'] },
          { main: 'https://images.unsplash.com/photo-1595950653106-6c9ebd614d3a?w=800', gallery: ['https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400', 'https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=400'] }
        ];

        const productTitles = ['NeoTech', 'Innovate', 'Catalyst', 'Quantum', 'Fusion', 'Apex', 'Evolve', 'Synergy', 'Lumina', 'Pinnacle', 'Odyssey', 'Zenith', 'Elysium', 'Nexus', 'Stellar', 'Vortex'];
        const productPrices = ['299.00', '349.00', '379.00', '399.00', '429.00', '449.00', '479.00', '499.00', '529.00', '549.00', '579.00', '599.00', '629.00', '649.00', '679.00', '699.00'];
        
        // Extract product index from handle (e.g., 'product-handle-1' -> 0)
        const handleMatch = productHandle.match(/product-handle-(\d+)/);
        const index = handleMatch ? parseInt(handleMatch[1]) - 1 : 0;
        const imageData = placeholderImages[index] || placeholderImages[0];
        const title = productTitles[index] || 'Product';
        const price = productPrices[index] || '199.00';

        return {
          title: title,
          price: { amount: price, currencyCode: 'SEK' },
          mainImage: imageData.main,
          gallery: imageData.gallery,
          description: `<p>${title} is a premium product designed for the modern lifestyle. Crafted with cutting-edge technology and attention to detail, this item represents the perfect blend of style and functionality. Each piece is carefully selected and designed to meet the highest standards of quality.</p><p>Experience the difference with ${title} - where innovation meets timeless design.</p>`,
          careInstructions: '<p><strong>Care Instructions:</strong></p><ul><li>Hand wash recommended in cold water</li><li>Do not bleach or use harsh detergents</li><li>Lay flat to dry</li><li>Iron on low heat if needed</li><li>Store in a cool, dry place</li><li>Keep away from direct sunlight when storing</li></ul>'
        };
      }

      // Populate drawer with placeholder data
      function populatePlaceholderDrawer(placeholderData) {
        // Product title and price
        $('#drawer-product-title').text(placeholderData.title);
        $('#drawer-product-price').text(`${placeholderData.price.amount} ${placeholderData.price.currencyCode}`);

        // Main image
        $('#drawer-main-image').attr('src', placeholderData.mainImage).attr('alt', placeholderData.title);
        
        // Gallery images
        const gallery = $('#drawer-gallery');
        gallery.empty();
        
        if (placeholderData.gallery && placeholderData.gallery.length > 0) {
          placeholderData.gallery.forEach((imageUrl, index) => {
            const galleryItem = $('<div class="products_drawer-more-item"></div>');
            const galleryImg = $('<img class="products_drawer-more-image" loading="lazy">');
            galleryImg.attr('src', imageUrl).attr('alt', `${placeholderData.title} - Image ${index + 2}`);
            galleryItem.append(galleryImg);
            galleryItem.on('click', () => {
              $('#drawer-main-image').attr('src', imageUrl).attr('alt', `${placeholderData.title} - Image ${index + 2}`);
            });
            gallery.append(galleryItem);
          });
        }

        // Description
        if (placeholderData.description) {
          $('#drawer-description').html(placeholderData.description);
        }

        // Care instructions
        if (placeholderData.careInstructions) {
          $('#drawer-care-instructions').html(placeholderData.careInstructions);
        }

        // Delivery (default for all)
        $('#drawer-delivery').html(`
          <strong>Delivery Information:</strong><br>
          Standard shipping: 5-7 business days<br>
          Express shipping: 2-3 business days<br>
          Free shipping on orders over $100<br>
          International shipping available<br>
          Track your order through our shipping partner
        `);

        // Hide error and out of stock
        $('#drawer-error').hide();
        $('#drawer-out-of-stock').hide();
        $('#drawer-add-to-cart').prop('disabled', false);
      }

      // Open drawer
      function openDrawer(productHandle) {
        drawer.addClass('open');
        $('body').css('overflow', 'hidden'); // Lock body scroll

        // Check if it's a placeholder handle
        if (productHandle && productHandle.startsWith('product-handle-')) {
          // Show placeholder data immediately
          const placeholderData = getPlaceholderProduct(productHandle);
          populatePlaceholderDrawer(placeholderData);
          return;
        }

        // Otherwise, fetch from Shopify
        $('#drawer-loading').show();
        fetchProduct(productHandle)
          .then(product => {
            populateDrawer(product);
            $('#drawer-loading').hide();
          })
          .catch(error => {
            console.error('Error loading product:', error);
            $('#drawer-loading').hide();
            $('#drawer-error').show().find('div').text('Failed to load product details. Please try again.');
          });
      }

      // Close drawer
      function closeDrawer() {
        drawer.removeClass('open');
        $('body').css('overflow', ''); // Unlock body scroll
      }

      // Event handlers
      viewDetailsBtns.on('click', function(e) {
        e.preventDefault();
        const slide = $(this).closest('.swiper-slide');
        const productHandle = slide.data('product-handle');
        
        if (productHandle) {
          openDrawer(productHandle);
        } else {
          alert('Product handle not found. Please add data-product-handle attribute.');
        }
      });

      drawerCloseBtn.on('click', closeDrawer);
      drawerOverlay.on('click', closeDrawer);

      // Close drawer on ESC key
      $(document).on('keydown', function(e) {
        if (e.key === 'Escape' && drawer.hasClass('open')) {
          closeDrawer();
        }
      });

      // Accordion functionality for description sections
      $('.products_description-question').on('click', function() {
        const item = $(this).closest('.products_description-item');
        const isActive = item.hasClass('active');
        
        // Close all items
        $('.products_description-item').removeClass('active');
        
        // Open clicked item if it wasn't active
        if (!isActive) {
          item.addClass('active');
        }
      });

      // Add to cart button (placeholder - integrate with your cart system)
      $('#drawer-add-to-cart').on('click', function() {
        // TODO: Integrate with Shopify cart or your checkout system
        alert('Add to cart functionality will be integrated with Shopify checkout.');
      });
    });
  </script>
</body>
</html>

